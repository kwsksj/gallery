<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>先生専用アップロード</title>
		<link rel="stylesheet" href="./shared/gallery-core.css" />
		<link rel="stylesheet" href="./admin/admin.css" />
	</head>
	<body>
		<div
			id="app"
			class="app"
			data-api-base="https://gallery-star.shiawasenahito3000.workers.dev"
			data-gallery-json="./gallery.json"
		>
			<header class="app-header">
				<div class="app-header__left">
					<div class="app-title">先生専用アップロード</div>
					<nav class="tabs" aria-label="画面切替">
						<button type="button" class="tab is-active" data-tab="upload">
							アップロード
						</button>
						<button type="button" class="tab" data-tab="curation">
							整備モード
						</button>
						<button type="button" class="tab" data-tab="tools">ツール</button>
					</nav>
				</div>
				<div class="app-header__right">
					<div class="header-meta">
						<span class="header-meta__label">gallery.json</span>
						<span id="gallery-updated-at" class="header-meta__value">-</span>
					</div>
					<button id="trigger-gallery-update" class="btn btn--primary" type="button">
						ギャラリー更新
					</button>
				</div>
			</header>

			<div id="banner" class="banner" hidden></div>

			<main class="app-main">
				<section id="view-upload" class="view is-active" data-view="upload">
					<h2 class="view-title">新規登録</h2>

					<form id="upload-form" class="panel">
						<div class="form-row">
							<label class="label" for="upload-files">画像</label>
							<input id="upload-files" class="input" type="file" accept="image/*" multiple />
						</div>

						<div class="form-row">
							<div class="help">
								表紙（代表画像）は先頭扱いです。サムネをタップして表紙にできます。
							</div>
							<div id="upload-previews" class="preview-strip" aria-label="画像プレビュー"></div>
						</div>

						<div class="form-grid">
							<div class="form-row">
								<label class="label" for="upload-completed-date">完成日（撮影日）</label>
								<input id="upload-completed-date" class="input" type="date" />
								<div id="upload-exif-note" class="subnote"></div>
							</div>

							<div class="form-row">
								<label class="label" for="upload-group">教室/会場（開催グループ）</label>
								<select id="upload-group" class="input">
									<option value="">自動/手動</option>
								</select>
								<div class="subnote">
									同日に複数グループがある場合はここで選択します。
								</div>
							</div>

							<div class="form-row">
								<label class="label" for="upload-classroom">教室（Notion保存値）</label>
								<select id="upload-classroom" class="input"></select>
								<div class="subnote">保存時に「〇〇教室」へ正規化します。</div>
							</div>

							<div class="form-row">
								<label class="label" for="upload-venue">会場（任意）</label>
								<select id="upload-venue" class="input"></select>
								<div id="upload-venue-warning" class="warning" hidden></div>
							</div>
						</div>

						<div class="form-grid">
							<div class="form-row">
								<label class="label" for="upload-author">作者</label>
								<select id="upload-author" class="input">
									<option value="">未選択</option>
								</select>
								<div class="subnote">当日参加者候補 → なければ名簿検索</div>
							</div>
							<div class="form-row">
								<label class="label" for="upload-author-search">名簿検索</label>
								<input id="upload-author-search" class="input" type="text" placeholder="例：けい" />
								<div id="upload-author-search-results" class="suggest"></div>
							</div>
						</div>

						<div class="form-row">
							<label class="label" for="upload-title">作品名</label>
							<input id="upload-title" class="input" type="text" placeholder="例：木彫りのねこ" />
						</div>

						<div class="form-row">
							<label class="label" for="upload-caption">キャプション（任意）</label>
							<textarea id="upload-caption" class="input" rows="3"></textarea>
						</div>

						<div class="form-row">
							<label class="label" for="upload-tag-query">タグ</label>
							<div class="tag-input">
								<input
									id="upload-tag-query"
									class="input"
									type="text"
									placeholder="1文字目から検索"
									autocomplete="off"
								/>
								<div id="upload-tag-suggest" class="suggest"></div>
							</div>
							<div id="upload-tag-chips" class="chips" aria-label="タグ一覧"></div>
							<div id="upload-tag-derived-note" class="subnote"></div>
							<div id="upload-tag-children" class="chips" aria-label="子タグ候補"></div>
						</div>

						<div class="form-row">
							<label class="checkbox">
								<input id="upload-ready" type="checkbox" />
								<span>整備済として確定（公開ギャラリーに出してよい）</span>
							</label>
						</div>

						<div class="form-row form-actions">
							<button id="upload-submit" class="btn btn--primary" type="submit">
								アップロード＆Notion登録
							</button>
							<div id="upload-status" class="status"></div>
						</div>
					</form>
				</section>

				<section id="view-curation" class="view" data-view="curation">
					<h2 class="view-title">整備モード（未整備キュー）</h2>

					<div class="panel">
						<div class="toolbar">
							<button id="curation-refresh" class="btn" type="button">再読み込み</button>
							<div id="curation-status" class="status"></div>
						</div>

						<div class="toolbar toolbar--filters">
							<label class="label-inline">
								完成日（from）
								<input id="curation-from" class="input input--sm" type="date" />
							</label>
							<label class="label-inline">
								完成日（to）
								<input id="curation-to" class="input input--sm" type="date" />
							</label>
							<label class="label-inline">
								教室
								<select id="curation-classroom" class="input input--sm"></select>
							</label>
							<label class="checkbox checkbox--sm">
								<input id="curation-missing-title" type="checkbox" />
								<span>作品名なし</span>
							</label>
							<label class="checkbox checkbox--sm">
								<input id="curation-missing-author" type="checkbox" />
								<span>作者なし</span>
							</label>
							<label class="checkbox checkbox--sm">
								<input id="curation-missing-tags" type="checkbox" />
								<span>タグなし</span>
							</label>
						</div>
					</div>

					<div id="curation-grid" class="card-grid" aria-label="未整備作品一覧"></div>
				</section>

				<section id="view-tools" class="view" data-view="tools">
					<h2 class="view-title">ツール</h2>
					<div class="panel">
						<div class="help">
							タグ一括再計算（dry-run / apply）はCLI想定です（仕様書の通り）。
						</div>
						<div class="help">
							`node scripts/tag-recalc.mjs --dry-run`（適宜 `--apply`）を使用してください。
						</div>
					</div>
					<div class="panel">
						<div class="toolbar">
							<div>
								<div class="label">タグインデックス</div>
								<div id="tools-tags-generated-at" class="status">-</div>
							</div>
							<button id="trigger-tags-index-update" class="btn" type="button">
								タグインデックス再生成
							</button>
						</div>
						<div class="subnote">
							GitHub Actions を `workflow_dispatch` で起動します（Worker側で `GITHUB_TAGS_WORKFLOW_FILE` の設定が必要）。
						</div>
					</div>
				</section>
			</main>

			<div id="modal-root" class="modal-root" hidden aria-hidden="true"></div>
			<div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>
		</div>

		<script type="module" src="./admin/admin.js"></script>
	</body>
</html>
